---
title: "Basic usage of ggsimplestats"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{basic}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 5
)
```

```{r setup}
library(ggsimplestats)
```


## Minimal Example

This is a minimal example of how to add the statistics to a plot. In this example we use the `PlantGrowth` dataset.

```{r example}
library(ggplot2)
library(ggsimplestats)

theme_set(ggthemes::theme_few())

ggplot(PlantGrowth, aes(group, weight, fill=group)) +
  geom_boxplot()  +
  stat_kwAllPairsDunnTest()
```

## Change format of p-value

If wanted, the format of the p value / label can be changed. The default uses `scales::pvalue`. To format the p values as 'stars' we can. e.g. use the `stars.pval` function from `gtools`

```{r change-p-value-format}
ggplot(PlantGrowth, aes(group, weight, fill=group)) +
  geom_boxplot()  +
  stat_kwAllPairsDunnTest(format.fun = gtools::stars.pval, 
                          size = 15,
                          vjust = .3)
```

Or you can pass a lambda function to create a custom label.

```{r p-value-lambda-function}
ggplot(PlantGrowth, aes(group, weight, fill=group)) +
  geom_boxplot()  +
  stat_kwAllPairsDunnTest(format.fun = \(x) {glue::glue('my p-value {scales::pvalue(x)}')},
                          vjust = -.2)
```


## Use with facets

The statistics are calculated for each panel in the plot. 

```{r facet}

ggplot(na.omit(palmerpenguins::penguins), aes(species, bill_length_mm, fill=species)) +
  geom_boxplot()  +
  stat_kwAllPairsDunnTest(vjust = -.2) +
  facet_grid(~sex)

```

## Parametric test

Use a Anova with TukeyHSD as a parametric alternative.

```{r TukeyHSD}
ggplot(PlantGrowth, aes(group, weight, fill=group)) +
  geom_boxplot()  +
  stat_tukeyHSD()
```
Again, this works with facets too.

```{r tukey-and-facet}
ggplot(na.omit(palmerpenguins::penguins), aes(species, bill_length_mm, fill=species)) +
  geom_boxplot()  +
  stat_tukeyHSD(vjust = -.2) +
  facet_grid(~sex)
```

`step.increase` changes the space between two brackets.

```{r step.increase}
ggplot(na.omit(palmerpenguins::penguins), aes(species, bill_length_mm, fill=species)) +
  geom_boxplot()  +
  stat_tukeyHSD(vjust = -.2,
                step.increase = 0.2,
                format.fun = \(x) {glue::glue('parametric p-value\n{scales::pvalue(x)}')}) +
  facet_grid(~sex) +
  scale_y_continuous(expand = expansion(mult = c(0,0.15)))
```


